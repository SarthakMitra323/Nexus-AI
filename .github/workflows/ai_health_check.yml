name: AI Platform Health Monitor

on:
  schedule:
    - cron: "*/30 * * * *"  # Runs every 30 minutes
  workflow_dispatch:        # Allows manual trigger from GitHub UI

jobs:
  check-ai:
    name: Check AI Frontend and Backend
    runs-on: ubuntu-latest

    steps:
      - name: Check frontend availability
        shell: bash
        run: |
          echo "🔍 Checking frontend availability..."
          FRONTEND_URL="https://ainexusplatform.vercel.app/app.html"
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$FRONTEND_URL")

          if [ "$STATUS" -ne 200 ]; then
            echo "❌ Frontend DOWN! HTTP status: $STATUS"
            exit 1
          else
            echo "✅ Frontend OK (HTTP $STATUS)"
          fi

      - name: Check backend API health
        shell: bash
        run: |
          echo "🔍 Checking backend API health..."
          BACKEND_URL="https://nexus-ai-1s8u.onrender.com/api/chat"

          # Send a safe, minimal dummy POST (won’t trigger real AI response)
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST "$BACKEND_URL" \
            -H "Content-Type: application/json" \
            -d '{"messages":[{"role":"user","content":"ping"}],"model":"fast"}')

          if [ "$STATUS" -ne 200 ]; then
            echo "⚠️ Backend may be DOWN or unhealthy (HTTP $STATUS)"
            exit 1
          else
            echo "✅ Backend API OK (HTTP $STATUS)"
          fi

      - name: Write summary
        if: always()
        shell: bash
        run: |
          echo "## 🧠 AI Health Check Summary" >> $GITHUB_STEP_SUMMARY
          echo "- Frontend: https://ainexusplatform.vercel.app/app.html" >> $GITHUB_STEP_SUMMARY
          echo "- Backend: https://nexus-ai-1s8u.onrender.com/api/chat" >> $GITHUB_STEP_SUMMARY
          echo "- Last check: $(date -u)" >> $GITHUB_STEP_SUMMARY
          echo "- Status: ✅ Completed successfully" >> $GITHUB_STEP_SUMMARY
